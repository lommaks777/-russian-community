// –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –º–µ—Å—Ç–∞—Ö
// –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
import fs from 'fs';
import path from 'path';

const ROOT = process.cwd();
const PLACES_FILE = path.join(ROOT, 'data', 'places.js');
const ENRICHED_PLACES_FILE = path.join(ROOT, 'data', 'places_enriched.js');

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–≤–µ–∑–¥–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
function generateStars(rating) {
  if (!rating) return '';
  
  const fullStars = Math.floor(rating);
  const hasHalfStar = rating % 1 >= 0.5;
  const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
  
  let stars = '‚òÖ'.repeat(fullStars);
  if (hasHalfStar) stars += '‚òÜ';
  stars += '‚òÜ'.repeat(emptyStars);
  
  return stars;
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
function createDemoReviews() {
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, —á—Ç–æ–±—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç–∑—ã–≤—ã
  // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Google Places API
  return [];
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π
function createDemoDescription(name, category) {
  const descriptions = {
    "–†–µ—Å—Ç–æ—Ä–∞–Ω—ã": [
      "–£—é—Ç–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–π –∫—É—Ö–Ω–µ–π –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º –∫ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—é –±–ª—é–¥.",
      "–°–µ–º–µ–π–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –¥–æ–º–∞—à–Ω–µ–π –∫—É—Ö–Ω–µ –∏ —Å–≤–µ–∂–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö.",
      "–≠–ª–µ–≥–∞–Ω—Ç–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å –∏–∑—ã—Å–∫–∞–Ω–Ω—ã–º –º–µ–Ω—é –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ–º."
    ],
    "–ë–∞—Ä—ã": [
      "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞—Ä —Å —à–∏—Ä–æ–∫–∏–º –≤—ã–±–æ—Ä–æ–º –∫–æ–∫—Ç–µ–π–ª–µ–π –∏ –∂–∏–≤–æ–π –º—É–∑—ã–∫–æ–π.",
      "–£—é—Ç–Ω—ã–π –±–∞—Ä –≤ —Å—Ç–∏–ª–µ —Ä–µ—Ç—Ä–æ —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π –∏ –æ—Ç–ª–∏—á–Ω—ã–º–∏ –Ω–∞–ø–∏—Ç–∫–∞–º–∏.",
      "–¢—Ä–µ–Ω–¥–æ–≤—ã–π –±–∞—Ä —Å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–º–∏ –∫–æ–∫—Ç–µ–π–ª—è–º–∏ –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π."
    ],
    "–ö–æ—Ñ–µ": [
      "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ—Ñ–µ–π–Ω—è —Å –∑–µ—Ä–Ω–∞–º–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –æ–±–∂–∞—Ä–∫–∏ –∏ –¥–æ–º–∞—à–Ω–µ–π –≤—ã–ø–µ—á–∫–æ–π.",
      "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ—Ñ–µ–π–Ω—è —Å —É—é—Ç–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –±–∞—Ä–∏—Å—Ç–∞.",
      "–ö–æ—Ñ–µ–π–Ω—è –≤ —Å—Ç–∏–ª–µ –º–∏–Ω–∏–º–∞–ª–∏–∑–º —Å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∫–æ—Ñ–µ –∏ –ª–µ–≥–∫–∏–º–∏ –∑–∞–∫—É—Å–∫–∞–º–∏."
    ],
    "–ú–∞–≥–∞–∑–∏–Ω": [
      "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω —Å —à–∏—Ä–æ–∫–∏–º –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç–æ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤.",
      "–°–µ–º–µ–π–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω —Å –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–µ–π –∏—Å—Ç–æ—Ä–∏–µ–π –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ–º.",
      "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ —É–¥–æ–±–Ω—ã–º —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ–º."
    ],
    "–°–ø–æ—Ä—Ç": [
      "–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ —Ç—Ä–µ–Ω–µ—Ä–∞–º–∏.",
      "–§–∏—Ç–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º–∏ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º.",
      "–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–ª—É–± —Å –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π –∏ –æ–ø—ã—Ç–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞–º–∏."
    ],
    "–ö—Ä–∞—Å–æ—Ç–∞": [
      "–°–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –º–∞—Å—Ç–µ—Ä–∞–º–∏ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏.",
      "–°–ø–∞-—Ü–µ–Ω—Ç—Ä —Å —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–º–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–º–∏ –∏ —É—é—Ç–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π.",
      "–°—Ç—É–¥–∏—è –∫—Ä–∞—Å–æ—Ç—ã —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏."
    ]
  };
  
  const categoryDescriptions = descriptions[category] || ["–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ —Å —Ö–æ—Ä–æ—à–∏–º –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ–º."];
  return categoryDescriptions[Math.floor(Math.random() * categoryDescriptions.length)];
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã
function createDemoOpeningHours() {
  const schedules = [
    ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: 9:00 - 22:00", "–í—Ç–æ—Ä–Ω–∏–∫: 9:00 - 22:00", "–°—Ä–µ–¥–∞: 9:00 - 22:00", "–ß–µ—Ç–≤–µ—Ä–≥: 9:00 - 22:00", "–ü—è—Ç–Ω–∏—Ü–∞: 9:00 - 23:00", "–°—É–±–±–æ—Ç–∞: 10:00 - 23:00", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 10:00 - 21:00"],
    ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: 8:00 - 20:00", "–í—Ç–æ—Ä–Ω–∏–∫: 8:00 - 20:00", "–°—Ä–µ–¥–∞: 8:00 - 20:00", "–ß–µ—Ç–≤–µ—Ä–≥: 8:00 - 20:00", "–ü—è—Ç–Ω–∏—Ü–∞: 8:00 - 21:00", "–°—É–±–±–æ—Ç–∞: 9:00 - 21:00", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 9:00 - 19:00"],
    ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫: 10:00 - 24:00", "–í—Ç–æ—Ä–Ω–∏–∫: 10:00 - 24:00", "–°—Ä–µ–¥–∞: 10:00 - 24:00", "–ß–µ—Ç–≤–µ—Ä–≥: 10:00 - 24:00", "–ü—è—Ç–Ω–∏—Ü–∞: 10:00 - 02:00", "–°—É–±–±–æ—Ç–∞: 10:00 - 02:00", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ: 10:00 - 24:00"]
  ];
  
  return schedules[Math.floor(Math.random() * schedules.length)];
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–æ–≥–∞—â–µ–Ω–∏—è –º–µ—Å—Ç–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
function enrichPlaceWithDemoData(place) {
  const rating = Math.random() * 2 + 3; // –†–µ–π—Ç–∏–Ω–≥ –æ—Ç 3.0 –¥–æ 5.0
  const userRatingsTotal = Math.floor(Math.random() * 200) + 10; // –û—Ç 10 –¥–æ 210 –æ—Ç–∑—ã–≤–æ–≤
  const priceLevel = Math.floor(Math.random() * 4); // –û—Ç 0 –¥–æ 3
  
  return {
    ...place,
    // –†–µ–π—Ç–∏–Ω–≥ –∏ –æ—Ç–∑—ã–≤—ã
    rating: parseFloat(rating.toFixed(1)),
    user_ratings_total: userRatingsTotal,
    stars: generateStars(rating),
    
    // –û–ø–∏—Å–∞–Ω–∏–µ
    description: createDemoDescription(place.name, place.category),
    short_description: createDemoDescription(place.name, place.category).substring(0, 100) + "...",
    
    // –¢–∏–ø –º–µ—Å—Ç–∞
    place_type: place.category,
    types: [place.category.toLowerCase()],
    
    // –¶–µ–Ω–æ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å
    price_level: priceLevel,
    price_text: ['–ë–µ—Å–ø–ª–∞—Ç–Ω–æ', '–ù–µ–¥–æ—Ä–æ–≥–æ', '–£–º–µ—Ä–µ–Ω–Ω–æ', '–î–æ—Ä–æ–≥–æ', '–û—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ'][priceLevel],
    
    // –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã
    opening_hours: createDemoOpeningHours(),
    is_open_now: Math.random() > 0.5,
    
    // –û—Ç–∑—ã–≤—ã
    reviews: createDemoReviews(),
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
    photos: place.photo_url ? [{
      reference: "demo_photo",
      url: place.photo_url
    }] : [],
    
    // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    last_updated: new Date().toISOString(),
    enriched: true,
    demo_data: true
  };
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
async function main() {
  console.log('üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
  if (!fs.existsSync(PLACES_FILE)) {
    console.log('‚ùå –§–∞–π–ª places.js –Ω–µ –Ω–∞–π–¥–µ–Ω');
    return;
  }
  
  const placesContent = fs.readFileSync(PLACES_FILE, 'utf8');
  const placesMatch = placesContent.match(/window\.PLACES\s*=\s*(\[.*?\]);/s);
  
  if (!placesMatch) {
    console.log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ places.js');
    return;
  }
  
  const places = JSON.parse(placesMatch[1]);
  console.log(`üìä –ù–∞–π–¥–µ–Ω–æ –º–µ—Å—Ç: ${places.length}`);
  
  // –û–±–æ–≥–∞—â–∞–µ–º –∫–∞–∂–¥–æ–µ –º–µ—Å—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
  const enrichedPlaces = places.map((place, index) => {
    console.log(`üìç [${index + 1}/${places.length}] –û–±–æ–≥–∞—â–µ–Ω–∏–µ: ${place.name}`);
    return enrichPlaceWithDemoData(place);
  });
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  const enrichedContent = `window.PLACES = ${JSON.stringify(enrichedPlaces, null, 2)};`;
  fs.writeFileSync(ENRICHED_PLACES_FILE, enrichedContent);
  
  console.log(`\n‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ!`);
  console.log(`üìÅ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤: ${ENRICHED_PLACES_FILE}`);
  
  // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  const withRating = enrichedPlaces.filter(p => p.rating).length;
  const withDescription = enrichedPlaces.filter(p => p.description).length;
  const withReviews = enrichedPlaces.filter(p => p.reviews && p.reviews.length > 0).length;
  const withOpeningHours = enrichedPlaces.filter(p => p.opening_hours && p.opening_hours.length > 0).length;
  
  console.log(`\nüìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:`);
  console.log(`  –° —Ä–µ–π—Ç–∏–Ω–≥–æ–º: ${withRating}/${enrichedPlaces.length}`);
  console.log(`  –° –æ–ø–∏—Å–∞–Ω–∏–µ–º: ${withDescription}/${enrichedPlaces.length}`);
  console.log(`  –° –æ—Ç–∑—ã–≤–∞–º–∏: ${withReviews}/${enrichedPlaces.length}`);
  console.log(`  –° —á–∞—Å–∞–º–∏ —Ä–∞–±–æ—Ç—ã: ${withOpeningHours}/${enrichedPlaces.length}`);
  
  console.log(`\nüéâ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.`);
}

// –ó–∞–ø—É—Å–∫
main().catch(error => {
  console.error('‚ùå –û—à–∏–±–∫–∞:', error);
  process.exit(1);
});
