<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>–†—É—Å—Å–∫–∞—è –∫–∞—Ä—Ç–∞ –ë–ê</title>
  <link rel="icon" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="28" fill="%230b57d0"/><text x="32" y="40" font-size="28" text-anchor="middle" fill="white" font-family="Arial, Helvetica, sans-serif">R</text></svg>' />
  <style>
    :root { color-scheme: dark; }
    html, body { height:100%; margin:0; background:#0f0f0f; color:#e0e0e0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; font-size: 15px; line-height: 1.6; }
    header {
      position: fixed; top:0; left:0; right:0; z-index:1000;
      background:#111; border-bottom:1px solid #222;
      display:flex; gap:12px; align-items:center; padding:12px 16px; font-size:16px;
    }
    header a { color:#9ecbff; text-decoration:none; font-weight:500; }
    header a:hover { text-decoration:underline; }
    .wrap { position:absolute; top:44px; left:0; right:0; bottom:0; }
    #map  { width:100%; height:100%; }
    .err { position:fixed; left:10px; bottom:10px; background:#1e1e1e; border:1px solid #333; color:#f66; padding:8px 10px; border-radius:8px; font-size:12px; max-width:90vw; display:none; }
    
    /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .controls {
      position: fixed; top: 44px; left: 10px; z-index: 999;
      background: rgba(26, 26, 26, 0.9); border: 1px solid #444; border-radius: 8px;
      padding: 12px; min-width: 200px; max-width: 250px; backdrop-filter: blur(10px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    }
    .controls h3 { 
      margin: 0 0 8px 0; font-size: 14px; color: #fff; 
      border-bottom: 1px solid #0b57d0; padding-bottom: 4px;
    }
    .controls select, .controls input { 
      width: 100%; padding: 8px; margin: 4px 0; background: #2a2a2a; border: 1px solid #555; 
      color: #e0e0e0; border-radius: 6px; font-size: 12px; transition: all 0.2s;
    }
    .controls select:focus, .controls input:focus {
      border-color: #0b57d0; box-shadow: 0 0 0 2px rgba(11, 87, 208, 0.2);
    }
    .controls button { 
      width: 100%; padding: 8px; margin: 4px 0; background: linear-gradient(135deg, #0b57d0, #1e88e5); 
      border: none; color: white; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 500;
      transition: all 0.2s; box-shadow: 0 2px 8px rgba(11, 87, 208, 0.3);
    }
    .controls button:hover { 
      background: linear-gradient(135deg, #0d4fb8, #1976d2); 
      transform: translateY(-1px); box-shadow: 0 4px 12px rgba(11, 87, 208, 0.4);
    }
    
    /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –ø–∞–Ω–µ–ª—å —Å–æ–±—ã—Ç–∏–π */
    .events-panel {
      position: fixed; top: 44px; right: 10px; z-index: 999;
      background: rgba(26, 26, 26, 0.9); border: 1px solid #444; border-radius: 8px;
      padding: 12px; width: 280px; max-height: 400px; overflow-y: auto; backdrop-filter: blur(10px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.3);
    }
    .events-panel h3 { 
      margin: 0 0 8px 0; font-size: 14px; color: #fff; 
      border-bottom: 1px solid #0b57d0; padding-bottom: 4px;
    }
    .event-item { 
      background: linear-gradient(135deg, #2a2a2a, #333); border: 1px solid #555; border-radius: 6px; 
      padding: 8px; margin: 4px 0; cursor: pointer; transition: all 0.2s;
      box-shadow: 0 1px 4px rgba(0,0,0,0.2);
    }
    .event-item:hover { 
      background: linear-gradient(135deg, #333, #444); 
      transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .event-title { 
      font-weight: 600; color: #9ecbff; margin-bottom: 4px; font-size: 12px;
      line-height: 1.3;
    }
    .event-date { color: #aaa; font-size: 10px; margin-bottom: 2px; }
    .event-tags { margin-top: 4px; }
    .event-tag { 
      display: inline-block; background: linear-gradient(135deg, #444, #555); color: #e0e0e0; 
      padding: 2px 6px; border-radius: 4px; font-size: 9px; margin: 1px; font-weight: 500;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è InfoWindow */
    .gm-style .gm-style-iw {
      background-color: #1a1a1a !important;
      border: 1px solid #444 !important;
      border-radius: 12px !important;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4) !important;
    }
    .gm-style .gm-style-iw-c {
      padding: 0 !important;
    }
    .gm-style .gm-style-iw-d {
      overflow: hidden !important;
    }
    .gm-style .gm-style-iw-tc {
      display: none !important;
    }
    
    /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ InfoWindow */
    .place-info {
      background: #1a1a1a; color: #e0e0e0; padding: 12px; max-width: 280px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .place-info h3 {
      color: #fff; margin: 0 0 8px 0; font-size: 14px; font-weight: 600;
      border-bottom: 1px solid #0b57d0; padding-bottom: 4px;
    }
    .place-info .rating {
      display: flex; align-items: center; margin: 4px 0;
      font-size: 12px; color: #e0e0e0;
    }
    .place-info .rating .stars {
      color: #ffd700; margin-right: 6px; font-size: 12px;
    }
    .place-info .rating .reviews {
      color: #aaa; font-size: 10px;
    }
    .place-info .description {
      margin: 6px 0; line-height: 1.4; color: #ccc; font-size: 11px;
    }
    .place-info .address {
      margin: 4px 0; color: #aaa; font-size: 10px;
    }
    .place-info .contact {
      margin: 4px 0; display: flex; flex-direction: column; gap: 2px;
    }
    .place-info .contact a {
      color: #9ecbff; text-decoration: none; font-size: 10px;
    }
    .place-info .contact a:hover {
      text-decoration: underline;
    }
    .place-info .tags {
      margin: 6px 0; display: flex; flex-wrap: wrap; gap: 2px;
    }
    .place-info .tag {
      background: linear-gradient(135deg, #444, #555); color: #e0e0e0;
      padding: 2px 6px; border-radius: 4px; font-size: 9px; font-weight: 500;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
      .controls, .events-panel { 
        position: relative; margin: 10px; width: calc(100% - 20px); 
        top: auto; left: auto; right: auto; bottom: auto;
        max-width: none;
      }
      .wrap { top: 0; }
      .place-info { max-width: 250px; padding: 10px; }
    }
    
    /* –°–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–∞—Ö */
    @media (max-width: 1024px) {
      .events-panel { display: none; }
      .controls { max-width: 200px; }
    }
  </style>
</head>
<body>
<header>
  <div style="flex:1;font-weight:600">–†—É—Å—Å–∫–∞—è –∫–∞—Ä—Ç–∞ –ë–ê</div>
  <a href="add.html">–î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ</a>
  <a href="events.html">–°–æ–±—ã—Ç–∏—è</a>
</header>

<!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
<div class="controls">
  <h3>üîç –§–∏–ª—å—Ç—Ä—ã</h3>
  <select id="categoryFilter">
    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
    <option value="–ö–æ—Ñ–µ">‚òï –ö–æ—Ñ–µ</option>
    <option value="–†–µ—Å—Ç–æ—Ä–∞–Ω—ã">üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω—ã</option>
    <option value="–ë–∞—Ä—ã">üç∏ –ë–∞—Ä—ã</option>
    <option value="–ö–∞–ª—å—è–Ω">üí® –ö–∞–ª—å—è–Ω</option>
    <option value="–°–ø–æ—Ä—Ç">üèüÔ∏è –°–ø–æ—Ä—Ç</option>
    <option value="–†–∞–±–æ—Ç–∞">üíº –†–∞–±–æ—Ç–∞</option>
    <option value="–ú–∞–≥–∞–∑–∏–Ω">üõçÔ∏è –ú–∞–≥–∞–∑–∏–Ω</option>
    <option value="–ò–≤–µ–Ω—Ç—ã">üéâ –ò–≤–µ–Ω—Ç—ã</option>
    <option value="–£—Å–ª—É–≥–∏">üß∞ –£—Å–ª—É–≥–∏</option>
    <option value="–î–µ—Ç–∏">üë∂ –î–µ—Ç–∏</option>
    <option value="–ö—Ä–∞—Å–æ—Ç–∞">üåº –ö—Ä–∞—Å–æ—Ç–∞</option>
    <option value="–û–±—É—á–µ–Ω–∏–µ">üéì –û–±—É—á–µ–Ω–∏–µ</option>
  </select>
  
  <select id="neighborhoodFilter">
    <option value="">–í—Å–µ —Ä–∞–π–æ–Ω—ã</option>
    <option value="Palermo">Palermo</option>
    <option value="Recoleta">Recoleta</option>
    <option value="San Telmo">San Telmo</option>
    <option value="Puerto Madero">Puerto Madero</option>
    <option value="Belgrano">Belgrano</option>
    <option value="Villa Crespo">Villa Crespo</option>
    <option value="Caballito">Caballito</option>
  </select>
  
  <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." />
  
  <button onclick="clearFilters()">–û—á–∏—Å—Ç–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
  <button onclick="toggleEventsPanel()">–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–±—ã—Ç–∏—è</button>
</div>

<!-- –ü–∞–Ω–µ–ª—å —Å–æ–±—ã—Ç–∏–π -->
<div class="events-panel" id="eventsPanel" style="display: none;">
  <h3>üé≠ –°–æ–±—ã—Ç–∏—è</h3>
  <div id="eventsList">
    <div style="text-align: center; color: #999; padding: 20px;">
      –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...
    </div>
  </div>
</div>

<div class="wrap"><div id="map"></div></div>
<div id="err" class="err"></div>

<!-- –î–∞–Ω–Ω—ã–µ —Ç–æ—á–µ–∫ (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è Actions). –§–∞–π–ª –î–û–õ–ñ–ï–ù —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å -->
<script src="data/places_enriched.js"></script>

<script>
/* === –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π map.js === */
const GOOGLE_KEY = "AIzaSyB7-RgotVuWFR6qMvr_Alf8nQvkYd7I3WI";
const MAP_ID     = "573d7da16cb24e9ec7c4e07e";
const BA_CENTER  = { lat:-34.6037, lng:-58.3816 };

const CATEGORY_EMOJI = {
  "–ö–æ—Ñ–µ":"‚òï","–†–µ—Å—Ç–æ—Ä–∞–Ω—ã":"üçΩÔ∏è","–ë–∞—Ä—ã":"üç∏","–ö–∞–ª—å—è–Ω":"üí®","–°–ø–æ—Ä—Ç":"üèüÔ∏è","–†–∞–±–æ—Ç–∞":"üíº",
  "–ú–∞–≥–∞–∑–∏–Ω":"üõçÔ∏è","–ò–≤–µ–Ω—Ç—ã":"üéâ","–£—Å–ª—É–≥–∏":"üß∞","–î–µ—Ç–∏":"üë∂","–ö—Ä–∞—Å–æ—Ç–∞":"üåº","–û–±—É—á–µ–Ω–∏–µ":"üéì"
};

const ERR = (t)=>{ const el=document.getElementById('err'); el.textContent=t; el.style.display='block'; };

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–≤–µ–∑–¥–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞
function generateStars(rating) {
  if (!rating) return '';
  
  const fullStars = Math.floor(rating);
  const hasHalfStar = rating % 1 >= 0.5;
  const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
  
  let stars = '‚òÖ'.repeat(fullStars);
  if (hasHalfStar) stars += '‚òÜ';
  stars += '‚òÜ'.repeat(emptyStars);
  
  return stars;
}

(function loadMaps(){
  // –µ—Å–ª–∏ data/places.js –Ω–µ —É—Å–ø–µ–ª –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
  if (!Array.isArray(window.PLACES)) window.PLACES = [];
  const url = `https://maps.googleapis.com/maps/api/js?key=${encodeURIComponent(GOOGLE_KEY)}&v=weekly&libraries=marker&language=ru&region=AR&loading=async&callback=initMap`;
  const s = document.createElement('script');
  s.src=url; s.defer=true; s.async=true;
  s.onerror = ()=>ERR('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Google Maps JS (–ø—Ä–æ–≤–µ—Ä—å –∫–ª—é—á/–¥–æ–º–µ–Ω/–∏–Ω—Ç–µ—Ä–Ω–µ—Ç).');
  document.head.appendChild(s);
})();

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–±—ã—Ç–∏—è
(function loadEvents() {
  const script = document.createElement('script');
  script.src = 'data/events.js';
  script.onload = () => {
    if (window.EVENTS && Array.isArray(window.EVENTS)) {
      renderEvents();
    }
  };
  document.head.appendChild(script);
})();

function withKeyForPlacesMedia(url){
  if (!url) return "";
  try{
    const u = new URL(url);
    if (u.hostname === "places.googleapis.com" && u.pathname.includes("/v1/") && u.pathname.endsWith("/media")){
      if (!u.searchParams.has("key")) u.searchParams.set("key", GOOGLE_KEY);
      return u.toString();
    }
  }catch{}
  return url;
}

async function initMap(){
  try{
    const {Map} = await google.maps.importLibrary("maps");
    const {AdvancedMarkerElement, PinElement} = await google.maps.importLibrary("marker");

    const map = new Map(document.getElementById("map"), {
      center: BA_CENTER, zoom: 12, mapId: MAP_ID, clickableIcons: false
    });

    const infowin = new google.maps.InfoWindow();

    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∞—Ä–∫–µ—Ä—ã
    allMarkers = [];

    (window.PLACES || []).forEach(p => {
      const emoji = CATEGORY_EMOJI[p.category] || "üìç";

      const glyph = document.createElement("div");
      glyph.textContent = emoji;
      glyph.style.fontSize = "22px";
      glyph.style.lineHeight = "22px";

      const pin = new PinElement({
        glyph, background: "#111", borderColor:"#444", glyphColor:"#fff", scale: 1.1
      });

      const marker = new AdvancedMarkerElement({
        map, position:{lat:+p.lat,lng:+p.lng}, content: pin.element, title: p.name
      });

      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –º–∞—Ä–∫–µ—Ä–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
      marker.place = p;

      const photo = withKeyForPlacesMedia(p.photo_url);
      const img = photo
        ? `<img src="${photo}" alt="" style="width:100%;max-height:180px;object-fit:cover;border-radius:10px"
                 onerror="this.remove()">`
        : "";

      const site  = p.website   ? `<div><a href="${p.website}" target="_blank" rel="noopener">–°–∞–π—Ç</a></div>` : "";
      const insta = p.instagram ? `<div><a href="${p.instagram}" target="_blank" rel="noopener">Instagram</a></div>` : "";
      const phone = p.phone     ? `<div>‚òé ${p.phone}</div>` : "";

      // –°–æ–∑–¥–∞–µ–º –æ–±–æ–≥–∞—â–µ–Ω–Ω—ã–π HTML –¥–ª—è InfoWindow
      const ratingHtml = p.rating ? `
        <div class="rating">
          <span class="stars">${p.stars || generateStars(p.rating)}</span>
          <span class="rating-value">${p.rating.toFixed(1)}</span>
          <span class="reviews">(${p.user_ratings_total || 0} –æ—Ç–∑—ã–≤–æ–≤)</span>
        </div>
      ` : '';
      
      const descriptionHtml = p.description ? `
        <div class="description">${p.description}</div>
      ` : '';
      
      const priceHtml = p.price_text ? `
        <div style="color:#aaa;font-size:12px;margin:4px 0">üí∞ ${p.price_text}</div>
      ` : '';
      
      const typeHtml = p.place_type ? `
        <div style="color:#9ecbff;font-size:12px;margin:4px 0">üè∑Ô∏è ${p.place_type}</div>
      ` : '';
      
      const reviewsHtml = p.reviews && p.reviews.length > 0 && !p.demo_data ? `
        <div style="margin:8px 0">
          <div style="color:#ccc;font-size:12px;margin-bottom:4px">üí¨ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ç–∑—ã–≤—ã:</div>
          ${p.reviews.slice(0, 2).map(review => `
            <div style="background:#333;padding:6px;border-radius:4px;margin:4px 0;font-size:11px">
              <div style="color:#ffd700">${generateStars(review.rating)} ${review.author}</div>
              <div style="color:#ccc;margin-top:2px">${review.text.substring(0, 100)}${review.text.length > 100 ? '...' : ''}</div>
            </div>
          `).join('')}
        </div>
      ` : '';
      
      const openingHoursHtml = p.opening_hours && p.opening_hours.length > 0 ? `
        <div style="margin:8px 0">
          <div style="color:#ccc;font-size:12px;margin-bottom:4px">üïí –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã:</div>
          <div style="font-size:11px;color:#aaa">
            ${p.opening_hours.slice(0, 3).map(hour => `
              <div>${hour}</div>
            `).join('')}
          </div>
        </div>
      ` : '';

      const html = `
        <div class="place-info">
          <h3>${emoji} ${p.name || ""}</h3>
          ${ratingHtml}
          ${typeHtml}
          ${priceHtml}
          <div class="address">üìç <a href="https://maps.google.com/maps?q=${encodeURIComponent(p.address || '')}" target="_blank" style="color: #9ecbff; text-decoration: none;">${p.address || ""}</a></div>
          ${descriptionHtml}
          ${reviewsHtml}
          ${openingHoursHtml}
          <div class="contact">
            ${site}${insta}${phone}
          </div>
        </div>`;

      marker.addListener("click", () => {
        infowin.setContent(html);
        infowin.open({anchor: marker, map});
      });
      
      // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
      allMarkers.push(marker);
    });
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
    filteredMarkers = [...allMarkers];
    window.map = map;
  }catch(e){
    console.error(e);
    ERR('–ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å. –û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å (F12) ‚Üí Console: –ø—Ä–æ–≤–µ—Ä—å –æ—à–∏–±–∫–∏ –∫–ª—é—á–∞/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.');
  }
}

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
let allMarkers = [];
let filteredMarkers = [];

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
function applyFilters() {
  const category = document.getElementById('categoryFilter').value;
  const neighborhood = document.getElementById('neighborhoodFilter').value;
  const search = document.getElementById('searchInput').value.toLowerCase();
  
  // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã
  allMarkers.forEach(marker => marker.setMap(null));
  
  // –§–∏–ª—å—Ç—Ä—É–µ–º –º–∞—Ä–∫–µ—Ä—ã
  filteredMarkers = allMarkers.filter(marker => {
    const place = marker.place;
    if (!place) return false;
    
    // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    if (category && place.category !== category) return false;
    
    // –§–∏–ª—å—Ç—Ä –ø–æ —Ä–∞–π–æ–Ω—É
    if (neighborhood && place.neighborhood !== neighborhood) return false;
    
    // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∏—Å–∫—É
    if (search && !place.name.toLowerCase().includes(search)) return false;
    
    return true;
  });
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
  filteredMarkers.forEach(marker => marker.setMap(window.map));
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  updateStats();
}

function clearFilters() {
  document.getElementById('categoryFilter').value = '';
  document.getElementById('neighborhoodFilter').value = '';
  document.getElementById('searchInput').value = '';
  applyFilters();
}

function updateStats() {
  const total = allMarkers.length;
  const filtered = filteredMarkers.length;
  console.log(`–ü–æ–∫–∞–∑–∞–Ω–æ ${filtered} –∏–∑ ${total} –º–µ—Å—Ç`);
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–±—ã—Ç–∏–π
function renderEvents() {
  const eventsList = document.getElementById('eventsList');
  if (!window.EVENTS || !Array.isArray(window.EVENTS)) {
    eventsList.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">–°–æ–±—ã—Ç–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
    return;
  }
  
  const events = window.EVENTS.slice(0, 5); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5 —Å–æ–±—ã—Ç–∏–π
  eventsList.innerHTML = events.map(event => {
    const date = new Date(event.start);
    const dateStr = date.toLocaleDateString('ru-RU', { 
      day: 'numeric', 
      month: 'short', 
      hour: '2-digit', 
      minute: '2-digit' 
    });
    
    const tags = event.tags ? event.tags.map(tag => 
      `<span class="event-tag">${tag}</span>`
    ).join('') : '';
    
    return `
      <div class="event-item" onclick="openEvent('${event.url}')">
        <div class="event-title">${event.title}</div>
        <div class="event-date">${dateStr}</div>
        <div class="event-tags">${tags}</div>
      </div>
    `;
  }).join('');
}

function openEvent(url) {
  window.open(url, '_blank');
}

function toggleEventsPanel() {
  const panel = document.getElementById('eventsPanel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
document.addEventListener('DOMContentLoaded', function() {
  // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
  document.getElementById('categoryFilter').addEventListener('change', applyFilters);
  document.getElementById('neighborhoodFilter').addEventListener('change', applyFilters);
  document.getElementById('searchInput').addEventListener('input', applyFilters);
});
</script>
</body>
</html>
